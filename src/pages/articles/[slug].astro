---
import Layout from '../../components/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map(article => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

type Props = { article: CollectionEntry<'articles'> };
const { article } = Astro.props;
const { Content } = await article.render();

const formattedDate = article.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (rough estimate: 200 words per minute)
const content = article.body || '';
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);
---

<Layout title={article.data.title} description={article.data.description}>
  <article class="article-detail">
    <div class="container container-narrow">
      <header class="article-header">
        <a href="/articles" class="back-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
            <line x1="19" y1="12" x2="5" y2="12" />
            <polyline points="12 19 5 12 12 5" />
          </svg>
          Back to Articles
        </a>
        
        <div class="article-meta">
          <time datetime={article.data.date.toISOString()}>{formattedDate}</time>
          <span class="separator">Â·</span>
          <span>{readingTime} min read</span>
        </div>
        
        <h1>{article.data.title}</h1>
        
        {article.data.tags && article.data.tags.length > 0 && (
          <div class="article-tags">
            {article.data.tags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </header>
      
      <div class="prose">
        <Content />
      </div>
    </div>
  </article>
</Layout>

<style>
  .article-detail {
    padding: calc(70px + var(--space-16)) 0 var(--space-16);
  }
  
  .article-header {
    margin-bottom: var(--space-10);
  }
  
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    text-decoration: none;
    margin-bottom: var(--space-6);
    transition: color var(--transition-fast);
  }
  
  .back-link:hover {
    color: var(--color-text);
  }
  
  .article-meta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
  }
  
  .separator {
    opacity: 0.5;
  }
  
  .article-header h1 {
    margin-bottom: var(--space-4);
  }
  
  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
</style>
